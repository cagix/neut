<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Modules - Neut Programming Language</title>
    <meta name="description" content="A dependently-typed programming language with static memory management." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="css/general.css" />
    <link rel="stylesheet" href="highlight.css" />
    <meta property="og:title" content="Modules - Neut Programming Language" />
    <meta property="og:description" content="A dependently-typed programming language with static memory management." />
    <meta property="og:url" content="https://vekatze.github.io/neut/modules.md" />
    <meta property="og:type" content="article" />
  </head>
  <body>
    <div id="body-container">
      <header id="menu-bar">
        <h1 class="menu-title">
          <a href="overview.html">
            Neut Programming Language
          </a>
        </h1>

        <div class="right-buttons">
            <a href="https://github.com/vekatze/neut" class="menubar-item">
              <span>GitHub</span>
            </a>
        </div>
      </header>
      <div id="content-box">
        <aside id="sidebar">
          <nav class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="tutorial.html"><strong aria-hidden="true">3.</strong> Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hello-external-world.html"><strong aria-hidden="true">3.1.</strong> Hello External World</a></li><li class="chapter-item expanded "><a href="programming-in-neut.html"><strong aria-hidden="true">3.2.</strong> Programming in Neut</a></li><li class="chapter-item expanded "><a href="static-memory-management.html"><strong aria-hidden="true">3.3.</strong> Static Memory Management</a></li></ol></li><li class="chapter-item expanded "><a href="language-reference.html"><strong aria-hidden="true">4.</strong> Language Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">4.1.</strong> Commands</a></li><li class="chapter-item expanded "><a href="modules.html" class="active"><strong aria-hidden="true">4.2.</strong> Modules</a></li><li class="chapter-item expanded "><a href="statements.html"><strong aria-hidden="true">4.3.</strong> Statements</a></li><li class="chapter-item expanded "><a href="terms.html"><strong aria-hidden="true">4.4.</strong> Terms</a></li><li class="chapter-item expanded "><a href="primitives.html"><strong aria-hidden="true">4.5.</strong> Primitives</a></li><li class="chapter-item expanded "><a href="basis.html"><strong aria-hidden="true">4.6.</strong> Basis</a></li></ol></li><li class="chapter-item expanded "><a href="what-is-next.html"><strong aria-hidden="true">5.</strong> What is Next?</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="manual-installation.html"><strong aria-hidden="true">6.</strong> Manual Installation</a></li><li class="chapter-item expanded "><a href="development-environment.html"><strong aria-hidden="true">7.</strong> Development Environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lovely-lsp-showcase.html"><strong aria-hidden="true">7.1.</strong> Lovely LSP Showcase</a></li><li class="chapter-item expanded "><a href="rapid-prototyping.html"><strong aria-hidden="true">7.2.</strong> Rapid Prototyping</a></li><li class="chapter-item expanded "><a href="editor-setup.html"><strong aria-hidden="true">7.3.</strong> Editor Setup</a></li></ol></li><li class="chapter-item expanded "><a href="how-to-execute-types.html"><strong aria-hidden="true">8.</strong> How to Execute Types</a></li><li class="chapter-item expanded "><a href="benchmarks.html"><strong aria-hidden="true">9.</strong> Benchmarks</a></li></ol>
          </nav>
        </aside>

        <main id="content" tabindex="0">
          <article id="content-inner">
            <h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<p>A directory (including its all children) is a <em>module</em> if it contains a file named <code>module.ens</code>.</p>
<p>Below is the list of configurations of <code>module.ens</code>.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#target">target</a></li>
<li><a href="#dependency">dependency</a></li>
<li><a href="#archive">archive</a></li>
<li><a href="#build">build</a></li>
<li><a href="#source">source</a></li>
<li><a href="#prefix">prefix</a></li>
<li><a href="#foreign">foreign</a></li>
<li><a href="#preset">preset</a></li>
<li><a href="#antecedent">antecedent</a></li>
<li><a href="#inline-limit">inline-limit</a></li>
</ul>
<h2 id="target"><a class="header" href="#target"><code>target</code></a></h2>
<p>The field <code>target</code> defines the entry points of a module. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  target {
    TARGET-1 &quot;path/to/source/file-1.nt&quot;
    // ..
    TARGET-N &quot;path/to/source/file-n.nt&quot;
  }
  // ..
}
</code></pre>
<p>Suppose that your module has the following <code>target</code> in <code>module.ens</code>:</p>
<pre><code class="language-ens">{
  // ..
  target {
    foo &quot;foo.nt&quot;
    bar &quot;item/whatever.nt&quot;
  }
  // ..
}
</code></pre>
<p>In this case, your module has two targets: <code>foo</code> and <code>bar</code>. The entry point of <code>foo</code> is the <code>main</code> function in <code>(source-dir)/foo.nt</code>. The entry point of <code>bar</code> is the <code>main</code> function in <code>(source-dir)/item/whatever.nt</code>.</p>
<p>The names in <code>target</code> can be specified when running <code>neut build</code>. For example, given the above definition of <code>target</code>, you can run <code>neut build foo</code>.</p>
<p>The names of targets are also used as the names of executables. For example, if you run <code>neut build --install ./bin/</code>, two binaries named <code>foo</code> and <code>bar</code> will be created under the directory <code>./bin/</code>.</p>
<p><code>target</code> must have at least one field.</p>
<h2 id="dependency"><a class="header" href="#dependency"><code>dependency</code></a></h2>
<p>The field <code>dependency</code> defines the dependencies of a module. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  dependency {
    foo {
      digest &quot;(base64url-encoded sha256 checksum)&quot;
      mirror [
        &quot;URL-1&quot;
        // ..
        &quot;URL-N&quot;
      ]
      enable-preset &lt;true | false&gt; // ← optional field
    }
    // ..
    bar { .. }
  }
  // ..
}
</code></pre>
<p>An example of <code>dependency</code>:</p>
<pre><code class="language-ens">{
  // ..
  dependency {
    core {
      digest &quot;ub3MUXVac9F1rebIhl_Crm2_GJ7PzCAekgp8aYH3-mo&quot;
      mirror [
        &quot;https://github.com/vekatze/neut-core/raw/main/archive/0-38.tar.zst&quot;
      ]
      enable-preset true
    }
    some-package {
      digest &quot;F_ST8PtL9dLCDWVZ4GpuS7sviUU0_-TUz2s6iw-86KU&quot;
      mirror [
        &quot;https://example.com/foobarbuz/packages/22-3.tar.zst&quot;
      ]
    }
  }
  // ..
}
</code></pre>
<p>The field <code>digest</code> specifies the checksum of the tarball of the dependency. The digest is a Base64URL-encoded SHA256 checksum of the tarball. This digest is the &quot;real&quot; name of this dependency, and used as an identifier.</p>
<p>The field <code>mirror</code> specifies a list of URLs from which the compiler can fetch the tarball. When running <code>neut get</code>, the compiler will try to get the tarball if necessary, using this list from the beginning to the end.</p>
<p>The optional field <code>enable-preset</code> specifies whether to import <code>preset</code>s automatically, as in &quot;prelude&quot; in other languages. This field should only be used (and set to be true) with the core library. For more information, see the explanation of <code>preset</code> in this section.</p>
<p>The field <code>dependency</code> can be omitted. The default value of <code>dependency</code> is <code>{}</code>.</p>
<h2 id="archive"><a class="header" href="#archive"><code>archive</code></a></h2>
<p>The field <code>archive</code> defines the path of the directory into which the subcommand <code>neut archive</code> store tarballs. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  archive &quot;my-archive&quot;
  // ..
}
</code></pre>
<p>The field <code>archive</code> can be omitted. The default value of <code>archive</code> is <code>./archive/</code>.</p>
<h2 id="build"><a class="header" href="#build"><code>build</code></a></h2>
<p>The field <code>build</code> defines the path of the directory to store object files, executables, etc. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  build &quot;.build&quot;
  // ..
}
</code></pre>
<p>The field <code>build</code> can be omitted. The default value of <code>build</code> is <code>./build/</code>.</p>
<h2 id="source"><a class="header" href="#source"><code>source</code></a></h2>
<p>The field <code>source</code> defines the path of the directory to store source files. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  source &quot;.&quot;
  // ..
}
</code></pre>
<p>The field <code>source</code> can be omitted. The default value of <code>source</code> is <code>./source/</code>.</p>
<h2 id="prefix"><a class="header" href="#prefix"><code>prefix</code></a></h2>
<p>The field <code>prefix</code> defines the aliases of source files. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  prefix {
    Foo &quot;this.foo&quot;
    // ..
    Bar &quot;this.item.bar&quot;
  }
  // ..
}
</code></pre>
<p>Each field in <code>prefix</code> specifies an alias of the specified source file. For example, given the definition above, the code</p>
<pre><code class="language-neut">import {
  this.foo,
  this.item.bar {some-func},
}
</code></pre>
<p>can be rewritten into the following:</p>
<pre><code class="language-neut">import {
  Foo,
  Bar {some-func},
}
</code></pre>
<p>The prefixes specified in a <code>module.ens</code> of a module can be used only in the module.</p>
<p>The field <code>prefix</code> can be omitted. The default value of <code>prefix</code> is <code>{}</code></p>
<h2 id="foreign"><a class="header" href="#foreign"><code>foreign</code></a></h2>
<p>The field <code>foreign</code> defines a list of directories that contains platform-dependent object files. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  foreign [
    &quot;./ffi/&quot;
    // ..
    &quot;./some-directory/&quot;
  ]
  // ..
}
</code></pre>
<p>The structure of a directory specified in <code>foreign</code> must be something like the below:</p>
<pre><code class="language-text">./ffi/
├── amd64-linux/
│  ├── foo.o
│  └── bar.o
├── arm64-darwin/
│  ├── foo.o
│  └── bar.o
└── arm64-linux/
   ├── foo.o
   └── bar.o
</code></pre>
<p>That is, the directory must be of the following form:</p>
<pre><code class="language-text">{foreign-directory-root}/{platform-name}/(.. list of object files ..)
</code></pre>
<p>When building a module with <code>foreign</code> directories, all the object files placed in the corresponding <code>{platform-name}</code> in <code>foreign</code> directories are used during linking phase.</p>
<p>The &quot;object files&quot; here are expected to be something that can be generated using clang as follows:</p>
<pre><code class="language-sh">clang -c -o ffi/arm64-darwin/foo.o path/to/foo.c
</code></pre>
<p>The field <code>foreign</code> can be omitted. The default value of <code>foreign</code> is <code>[]</code>.</p>
<div class="info-block">
<p>If you peek at the <code>build</code> directory, you'll find a directory named <code>artifact</code> that contains cache files (<code>foo.i</code>) and object files (<code>foo.o</code>). When linking phase, all the object files in the <code>artifact</code> directory and the object files in the <code>foreign</code> directories are linked to produce an executable.</p>
</div>
<h2 id="preset"><a class="header" href="#preset"><code>preset</code></a></h2>
<p>The field <code>preset</code> defines the list of names that must be imported implicitly when the module is used as a dependency. It should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  preset {
    foo [&quot;my-func&quot; &quot;other-func&quot;]
    item.bar [&quot;hoge&quot; &quot;pohe&quot;]
  }
  // ..
}
</code></pre>
<p>In the example above, the current module is expected to have the following files:</p>
<ul>
<li><code>(source-dir)/foo.nt</code> that contains the definitions of <code>my-func</code> and <code>other-func</code></li>
<li><code>(source-dir)/item/bar.nt</code> that contains the definitions of <code>hoge</code> and <code>pohe</code></li>
</ul>
<p>The field <code>preset</code> is used in combination with <code>enable-preset</code> in <code>dependency</code>.</p>
<p>Suppose we released a module that contains the definition of <code>preset</code> as in the above. Also, suppose someone is developing a module <code>MMM</code> and they added our module to <code>MMM</code>'s dependency:</p>
<pre><code class="language-ens">// module.ens in MMM

{
  // ..
  dependency {
    sample {
      digest &quot;BASE64_URL_ENCODED_SHA256_CHECKSUM&quot;
      mirror [&quot;SOME_URL&quot;]
      enable-preset true
    }
    // ..
  }
  // ..
}
</code></pre>
<p>In this case, source files in <code>MMM</code> imports our preset names automatically since <code>enable-preset</code> is <code>true</code>.</p>
<p>As an example, suppose a file in <code>MMM</code> contains an <code>import</code> like the below:</p>
<pre><code class="language-neut">import {
  sample.foo {my-func, other-func},
  sample.item.bar {hoge, pohe},
}

define buz() {
  let i = my-func() in
  print-int(i)
}
</code></pre>
<p>This code is the same as the following since the preset is enabled:</p>
<pre><code class="language-neut">define buz() {
  let i = my-func() in
  print-int(i)
}
</code></pre>
<p>The field <code>preset</code> is expected to be used as a way to realize &quot;preludes&quot; in other languages.</p>
<p>The field <code>preset</code> can be omitted. The default value of <code>preset</code> is <code>{}</code>.</p>
<h2 id="antecedent"><a class="header" href="#antecedent"><code>antecedent</code></a></h2>
<p>The field <code>antecedent</code> defines the list of older compatible versions. This field should look like the following:</p>
<pre><code class="language-ens">{
  // ..
  antecedent [
    &quot;Bp8RulJ-XGTL9Eovre0yQupJpeS3lGNk8Q6QQYua7ag&quot;
    // ..
    &quot;zptXghmyD5druBl8kx2Qrei6O6fDsKCA7z2KoHp1aqA&quot;
  ]
  // ..
}
</code></pre>
<p>This information is used to select the newest compatible version of the module. For more information, see the explanation on <code>neut archive</code> in <a href="./commands.html">Commands</a>.</p>
<p>The field <code>antecedent</code> can be omitted. The default value of <code>antecedent</code> is <code>[]</code>.</p>
<div class="info-block">
<p>You won't write this field by hand because it is inserted automatically into <code>module.ens</code> of a tarball when <code>neut archive</code> is executed.</p>
</div>
<h2 id="inline-limit"><a class="header" href="#inline-limit"><code>inline-limit</code></a></h2>
<p>The field <code>inline-limit</code> defines the limit on recursion performed during compilation. It should look like the below:</p>
<pre><code class="language-ens">{
  // ..
  inline-limit 1000000
  // ..
}
</code></pre>
<p>During compilation, the compiler performs possibly recursive computation when:</p>
<ul>
<li>type-checking, and</li>
<li>expanding the definitions of inline functions.</li>
</ul>
<p>The <code>inline-limit</code> specifies a limit here. If the limit is exceeded, the compiler reports an error like the following:</p>
<pre><code class="language-text">/path/to/file.nt:123:45
error: exceeded max recursion depth of 1000 during (..)
</code></pre>
<p>The field <code>inline-limit</code> can be omitted. The default value of <code>inline-limit</code> is <code>100000</code>.</p>

            <footer id="footer-paginator">
              <a rel="prev" href="commands.html" class="nav previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                ← Previous Page
              </a>

              <div id="footer-spacer"></div>

              <a rel="next" href="statements.html" class="nav next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                Next Page →
              </a>
            </footer>
          </article>
          <div id="footer-wrapper">
            <footer id="footer-nav">
              <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="tutorial.html"><strong aria-hidden="true">3.</strong> Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hello-external-world.html"><strong aria-hidden="true">3.1.</strong> Hello External World</a></li><li class="chapter-item expanded "><a href="programming-in-neut.html"><strong aria-hidden="true">3.2.</strong> Programming in Neut</a></li><li class="chapter-item expanded "><a href="static-memory-management.html"><strong aria-hidden="true">3.3.</strong> Static Memory Management</a></li></ol></li><li class="chapter-item expanded "><a href="language-reference.html"><strong aria-hidden="true">4.</strong> Language Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">4.1.</strong> Commands</a></li><li class="chapter-item expanded "><a href="modules.html" class="active"><strong aria-hidden="true">4.2.</strong> Modules</a></li><li class="chapter-item expanded "><a href="statements.html"><strong aria-hidden="true">4.3.</strong> Statements</a></li><li class="chapter-item expanded "><a href="terms.html"><strong aria-hidden="true">4.4.</strong> Terms</a></li><li class="chapter-item expanded "><a href="primitives.html"><strong aria-hidden="true">4.5.</strong> Primitives</a></li><li class="chapter-item expanded "><a href="basis.html"><strong aria-hidden="true">4.6.</strong> Basis</a></li></ol></li><li class="chapter-item expanded "><a href="what-is-next.html"><strong aria-hidden="true">5.</strong> What is Next?</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="manual-installation.html"><strong aria-hidden="true">6.</strong> Manual Installation</a></li><li class="chapter-item expanded "><a href="development-environment.html"><strong aria-hidden="true">7.</strong> Development Environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lovely-lsp-showcase.html"><strong aria-hidden="true">7.1.</strong> Lovely LSP Showcase</a></li><li class="chapter-item expanded "><a href="rapid-prototyping.html"><strong aria-hidden="true">7.2.</strong> Rapid Prototyping</a></li><li class="chapter-item expanded "><a href="editor-setup.html"><strong aria-hidden="true">7.3.</strong> Editor Setup</a></li></ol></li><li class="chapter-item expanded "><a href="how-to-execute-types.html"><strong aria-hidden="true">8.</strong> How to Execute Types</a></li><li class="chapter-item expanded "><a href="benchmarks.html"><strong aria-hidden="true">9.</strong> Benchmarks</a></li></ol>
            </footer>
          </div>
        </main>
      </div>


      <script src="highlight.js"></script>
      <script src="book.js"></script>
    </div>
  </body>
</html>
