struct bar(a: tau) by Bar {
- value: a
}

struct foo() by Foo {
- value-1: i64
- value-2: i32
- value-3: bar(i64)
}

struct stream(a: tau) by Stream {
- head: a
- tail: () -> stream(a)
}

define int-stream(x: i64): stream(i64) {
  Stream {
  - head <=
    x
  - tail <=
    lambda () {
      int-stream(add-i64(x, 1))
    }
  }
}

define get-tail[a](s: stream(a)): stream(a) {
  match s {
  - Stream(_, tail-generator) =>
    tail-generator()
  }
}

define get-head[a](s: stream(a)): a {
  match s {
  - Stream(v, _) =>
    v
  }
}

define main(): i64 {
  let inner = Bar(10)
  let config =
    Foo {
    - value-1 <= 3
    - value-3 <= inner
    - value-2 <= 8
    }
  let k on config = {
    let s1 = value-1(config)
    let s2 = !config::value-1
    let s3 = config::value-1
    let s4 = config::value-3::value
    add-i64(!s1, add-i64(s2, add-i64(!s3, !s4)))
  }
  let _ = config
  let some-stream = int-stream(3)
  // let value = some-stream[get-tail][tail][head]
  let value = some-stream::get-tail::get-tail::get-head
  add-i64(k, value)
}
