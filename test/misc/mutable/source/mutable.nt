import {
- core.list
- core.data.vector
}

data list(a: tau) {
- Nil()
- Cons(a, list(a))
}

define my-length(xs: &list(int)): int {
  &match xs {
  - Nil() =>
    0
  - Cons(_, ys) =>
    add-int(1, my-length(ys))
  }
}

define bar(xs-cell: &cell(list(int))): unit {
  borrow(_, xs-cell, (xs) => {
    let len = my-length(xs) in
    print-int(len);
    print("\n")
  })
}

define main(): unit {
  let xs: list(int) = Cons(1, Cons(2, Nil())) in
  let xs-cell = new-cell(_, xs) in
  let _ on xs-cell =
    let _ = bar(xs-cell) in
    mutate(_, xs-cell, (xs) => {
      Cons(4, xs)
    });
    let _ = bar(xs-cell) in
    mutate(_, xs-cell, (_) => {
      Nil()
    });
    mutate(_, xs-cell, (xs) => {
      Cons(4, xs)
    });
    bar(xs-cell)
  in
  let _ = xs-cell in
  Unit
}
