define main(): int {
  let ch = new-channel(() -> int)
  let ch: channel(() -> int) = ch
  let _ = ch
  let _ on ch = send(ch, lambda () {1})
  let ch = ch
  let ch-clone = ch
  let _ on ch-clone = send(ch-clone, lambda () {1})
  let _ on ch-clone = {
    // linear flow
    let f =
      detach {
        send(ch-clone, lambda () {3})
      }
    // relevant flow
    let g =
      detach {
        tau
      }
    let _ = g
    // affine flow
    let _ =
      detach {
        tau
      }
    let _ = receive(ch-clone)
    let _ = receive(ch-clone)
    let _ = receive(ch-clone)

    attach f
    attach g
  }
  let _ = ch-clone
  0
}
